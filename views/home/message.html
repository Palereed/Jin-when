{% extends 'nav.html' %}
{% block MainBody %}
    <div class="MessageContain">
       <div class="MessageTop">
           <!-- 原留言 -->
           <div class="ImgContain">
              <img src="public/images/message/owner.jpg" class="LetterImg">
           </div>
           <div class="LetterContain">
                   <!-- 留言者信息 -->
                   <div class="VisitInfo">
                      <span class="VisitName">
                          <a href="#">素年锦时</a>
                      </span>
                   </div>
                   <div class="LetterReal">
                       <p>吾之素年，汝与锦时。与你相见，不甚欣喜。留笔墨一二，互通有无。或有指点，愿闻其详。</p>
                   </div>
           </div>
           <div class="clearfix"></div>
       </div>
       <div class="TopLine"></div>
       <!-- 留言 -->
       <div class="LetterModule">
           <!-- 原留言 -->
           <div class="LetterOri">
               <!-- 头像 -->
               <div class="ImgContain">
                   <img src="public/images/message/visit1.jpg" class="LetterImg">
               </div>
               <!-- 留言内容 -->
               <div class="LetterContain">
                   <!-- 留言者信息 -->
                   <div class="VisitInfo">
                      <span class="VisitName">
                          <a href="#">蒹葭</a>
                      </span>
                      <span class="TimeContain">
                          留言于
                          <b class="VisitTime">03 April,2017</b>
                      </span>
                   </div>
                   <div class="LetterReal">
                       <p>两只黄鹂鸣翠柳，一行白鹭上青天。窗含西岭千秋雪，门泊东吴万里船。</p>
                   </div>
               </div>
               <div class="Answer">
                   <span class="fa fa-comment-o fa-lg"></span>
                   <i>0</i>
               </div>
               <div class="clearfix"></div>
           </div>
           <!-- 留言回复 -->
           <div class="AllAnswer">
               <!-- 留言回复内容 -->
               <div class="AnswerContain">
                    <div class="ImgContain">
                       <img src="public/images/message/owner.jpg" class="LetterImg">
                    </div>
                    <div class="LetterContain">
                        <div class="VisitInfo">
                          <span class="VisitName">
                            <a href="#">蒹葭</a>
                          </span>
                          <span class="TimeContain">
                             留言于
                            <b class="VisitTime">03 April,2017</b>
                          </span>
                        </div>
                        <div class="LetterReal">
                          <p>两只黄鹂鸣翠柳，一行白鹭上青天。窗含西岭千秋雪，门泊东吴万里船。</p>
                        </div>
                    </div>
                    <div class="clearfix"></div>
               </div>
               <!-- 留言回复表单 -->
               <div class="AnswerForm">
                   <span class="Answerit">我要回复</span>
                   <form>
                     <ul class="FormList">
                       <li><span>内容：</span><textarea class="form-control"></textarea></li>
                       <li><button type="submit" class="btn btn-default">回复</button></li>
                     </ul>
                   </form> 
               </div>
           </div>
       </div>
       <div class="LetterModule">
           <!-- 原留言 -->
           <div class="LetterOri">
               <!-- 头像 -->
               <div class="ImgContain">
                   <img src="public/images/message/visit1.jpg" class="LetterImg">
               </div>
               <!-- 留言内容 -->
               <div class="LetterContain">
                   <!-- 留言者信息 -->
                   <div class="VisitInfo">
                      <span class="VisitName">
                          <a href="#">蒹葭</a>
                      </span>
                      <span class="TimeContain">
                          留言于
                          <b class="VisitTime">03 April,2017</b>
                      </span>
                   </div>
                   <div class="LetterReal">
                       <p>两只黄鹂鸣翠柳，一行白鹭上青天。窗含西岭千秋雪，门泊东吴万里船。</p>
                   </div>
               </div>
               <div class="Answer">
                   <span class="fa fa-comment-o fa-lg"></span>
                   <i>0</i>
               </div>
               <div class="clearfix"></div>
           </div>
           <!-- 留言回复 -->
           <div class="AllAnswer">
               <!-- 留言回复内容 -->
               <div class="AnswerContain">
                    <div class="ImgContain">
                       <img src="public/images/message/owner.jpg" class="LetterImg">
                    </div>
                    <div class="LetterContain">
                        <div class="VisitInfo">
                          <span class="VisitName">
                            <a href="#">蒹葭</a>
                          </span>
                          <span class="TimeContain">
                             留言于
                            <b class="VisitTime">03 April,2017</b>
                          </span>
                        </div>
                        <div class="LetterReal">
                          <p>两只黄鹂鸣翠柳，一行白鹭上青天。窗含西岭千秋雪，门泊东吴万里船。</p>
                        </div>
                    </div>
                    <div class="clearfix"></div>
               </div>
               <!-- 留言回复表单 -->
               <div class="AnswerForm">
                   <span class="Answerit">我要回复</span>
                   <form>
                     <ul class="FormList">
                       <li><span>内容：</span><textarea class="form-control"></textarea></li>
                       <li><button type="submit" class="btn btn-default">回复</button></li>
                     </ul>
                   </form> 
               </div>
           </div>
       </div>
       <div class="LetterModule">
           <!-- 原留言 -->
           <div class="LetterOri">
               <!-- 头像 -->
               <div class="ImgContain">
                   <img src="public/images/message/visit1.jpg" class="LetterImg">
               </div>
               <!-- 留言内容 -->
               <div class="LetterContain">
                   <!-- 留言者信息 -->
                   <div class="VisitInfo">
                      <span class="VisitName">
                          <a href="#">蒹葭</a>
                      </span>
                      <span class="TimeContain">
                          留言于
                          <b class="VisitTime">03 April,2017</b>
                      </span>
                   </div>
                   <div class="LetterReal">
                       <p>两只黄鹂鸣翠柳，一行白鹭上青天。窗含西岭千秋雪，门泊东吴万里船。</p>
                   </div>
               </div>
               <div class="Answer">
                   <span class="fa fa-comment-o fa-lg"></span>
                   <i>0</i>
               </div>
               <div class="clearfix"></div>
           </div>
           <!-- 留言回复 -->
           <div class="AllAnswer">
               <!-- 留言回复内容 -->
               <div class="AnswerContain">
                    <div class="ImgContain">
                       <img src="public/images/message/owner.jpg" class="LetterImg">
                    </div>
                    <div class="LetterContain">
                        <div class="VisitInfo">
                          <span class="VisitName">
                            <a href="#">蒹葭</a>
                          </span>
                          <span class="TimeContain">
                             留言于
                            <b class="VisitTime">03 April,2017</b>
                          </span>
                        </div>
                        <div class="LetterReal">
                          <p>两只黄鹂鸣翠柳，一行白鹭上青天。窗含西岭千秋雪，门泊东吴万里船。</p>
                        </div>
                    </div>
                    <div class="clearfix"></div>
               </div>
               <!-- 留言回复表单 -->
               <div class="AnswerForm">
                   <span class="Answerit">我要回复</span>
                   <form>
                     <ul class="FormList">
                       <li><span>内容：</span><textarea class="form-control"></textarea></li>
                       <div class="AnswerBtn">
                          <div>
                            <i></i>
                            <span></span>
                          </div>
                       </div>
                       <li><button type="button" class="btn btn-default">回复</button></li>
                     </ul>
                   </form> 
               </div>
           </div>
       </div>
       <!-- 分页部分 -->
       <div class="PageNumber">
              {% if page <=1 %}
              <a href="javascript:;" class="CantUse">前页</a>
              {% else %}
              <a href="/message?page={{page-1}}">前页</a>
              {% endif %}
              <a class="Active">{{page}}</a>
              {% if page >= pages %}
              <a href="javascript:;" class="CantUse">后页</a>
              {% else %}
              <a href="/message?page={{page+1}}">后页</a>
              {% endif %}
       </div>
       <!-- 留言表单 -->
       <div class="TopTab">
          <div class="TabName">留言板</div>
          <div class="LandInfo">
              <!-- 管理员登陆 -->
              {% if visitInfo.isAdmin %}
              <span>
              {{decodeURI(visitInfo.visitmark)}}<i>/</i><a href="admin/home"><i class="fa fa-sign-in"></i>后台</a></span>
              <!-- 普通访问者 -->
              {% elseif visitInfo.visitname %}
              <span>{{decodeURI(visitInfo.visitmark)}}<i>/</i><b id="Landout"><i class="fa fa-sign-out"></i>退出</b></span>
              <!-- 未登录状态 -->
              {% else %}
              <span><b id="Landon"><i class="fa fa-sign-in"></i>登录</b></span>
              {% endif %}
              <div class="OnLand">
                  <img src={{visitInfo.visitimg}}>
              </div>
          </div>
          <div class="clearfix"></div>
       </div>
       <div class="LeaveContain">
          <div class="VisitLeave" id="Leave">
              <form>
                 <ul class="FormList">
                    <li><span>内容：</span><textarea class="form-control"></textarea></li>
                    <div class="LeaveBtn">
                        <div>
                          <i></i>
                          <span></span>
                        </div>
                    </div>
                    <li><button type="button" class="btn btn-default">留言</button></li>
                 </ul>
              </form>
          </div>
          <div class="VisitLand" id="Land">
              <form>
                 <ul class="FormList">
                    <li><span>账号：</span><input class="form-control" name="visitname"></input></li>
                    <li><span>密码：</span><input type="password" class="form-control" name="visitpass"></input></li>
                    <div class="LandBtn">
                        <div>
                          <i></i>
                          <span></span>
                        </div>
                    </div>
                    <li><button type="button" class="btn btn-default">登陆</button>
                        <button type="button" class="btn btn-default">注册</button>
                    </li>
                 </ul>
              </form>
          </div>
          <div class="VisitRegister" id="Register">
              <form>
              <ul class="FormList">
                 <li><span>账号：</span><input class="form-control" name="visitname"></input></li>
                 <li><span>昵称：</span><input class="form-control" name="visitmark"></input></li>
                 <li><span>密码：</span><input type="password" class="form-control" name="visitpass"></input></li>
                 <li><span>头像：</span><img src="/public/images/message/visit4.jpg" id="ShowImg"></li>
                 <li id="ImgChoose">
                       <span>选择：</span>
                       <img src="/public/images/message/visit1.jpg">
                       <img src="/public/images/message/visit2.jpg">
                       <img src="/public/images/message/visit3.jpg">
                       <img src="/public/images/message/visit4.jpg">
                       <img src="/public/images/message/visit5.jpg">
                       <img src="/public/images/message/visit6.jpg">
                       <img src="/public/images/message/visit7.jpg">
                       <img src="/public/images/message/visit8.jpg">
                 </li>
                 <li><span>密保：</span><input class="form-control" name="visitsafe"></input></li>
              </ul>
              </form>
              <div class="RegisterBtn">
                <div>
                  <i></i>
                  <span></span>
                </div>
              </div>
              <button type="button" class="btn btn-default">注册</button>
          </div>
       </div>
    </div>
    <link rel="stylesheet" type="text/css" href="public/css/message.css">
    <script>
        //回复
        $('.AnswerForm').find('button').click(function(){
           var IsLand = $('.LandInfo').find('img').attr('src');
           // 如果未登陆
           if( IsLand == '') {
                   $('.AnswerBtn').find('i').removeClass().addClass('fa fa-close');
                   $('.AnswerBtn').find('div').removeClass().addClass('alert alert-danger');
                   $('.AnswerBtn').find('span').html('登陆后回复');
              }
         })
        //留言
        $('#Leave').find('button').click(function(){
           var IsLand = $('.LandInfo').find('img').attr('src');
           // 如果未登陆
           if( IsLand == '') {
                 $('.LeaveBtn').find('i').removeClass().addClass('fa fa-close');
                 $('.LeaveBtn').find('div').removeClass().addClass('alert alert-danger');
                 $('.LeaveBtn').find('span').html('登陆后留言');
                 setTimeout(function(){
                    $('#Leave').hide();
                    $('#Land').show();
                 },1000);
            }
        })
        //注册
        $('#Register').find('button').click(function(){
          $.ajax({
            type: 'post',
            url: '/api/visiter/register',
            data: {
              visitname :$('#Register').find('[name="visitname"]').val(),
                  visitmark :$('#Register').find('[name="visitmark"]').val(),
                  visitpass :$('#Register').find('[name="visitpass"]').val(),
                  visitimg  :$('#Register').find('img').attr("src"),
                  visitsafe :$('#Register').find('[name="visitsafe"]').val()
              },
              dataType: 'json',
              success:function(result){
                var code = result.code;
                switch (code){
                  case 0:
                     $('.RegisterBtn').find('i').removeClass().addClass('fa fa-check');
                             $('.RegisterBtn').find('div').removeClass().addClass('alert alert-success');
                              setTimeout(function(){
                            $('#Register').hide();
                            $('#Land').show();
                         },1000);
                  break;
                  default:
                      $('.RegisterBtn').find('i').removeClass().addClass('fa fa-close');
                              $('.RegisterBtn').find('div').removeClass().addClass('alert alert-danger')
                  break;
                }
                $('.RegisterBtn').find('span').html(result.message);
              }
          })
        })
        //登陆
        $('#Land').find('button').eq(0).click(function(){
          $.ajax({
            type: 'post',
            url:'/api/visiter/land',
            data: {
                    visitname :$('#Land').find('[name="visitname"]').val(),
                    visitpass :$('#Land').find('[name="visitpass"]').val()
            },
                dataType: 'json',
                success:function(result){
                var code = result.code;
                switch (code){
                case 0:
                   $('.LandBtn').find('i').removeClass().addClass('fa fa-check');
                        $('.LandBtn').find('div').removeClass().addClass('alert alert-success');
                        $('.LandInfo').find('span').html(result.visitInfo.visitmark);
                        $('.LandInfo').find('img').attr('src',result.visitInfo.visitimg);
                      setTimeout(function(){
                        $('#Leave').show();
                        $('#Land').hide();
                        $('.AnswerBtn').find('i').removeClass();
                        $('.AnswerBtn').find('div').removeClass();
                        $('.AnswerBtn').find('span').html('');
                        $('.LeaveBtn').find('i').removeClass();
                        $('.LeaveBtn').find('div').removeClass();
                        $('.LeaveBtn').find('span').html('');
                     },1000);
                     window.location.reload();
                        break;
                        default:
                           $('.LandBtn').find('i').removeClass().addClass('fa fa-close');
                           $('.LandBtn').find('div').removeClass().addClass('alert alert-danger');
                        break;
               }
              $('.LandBtn').find('span').html(result.message);
                }
          })
        })
        //进入注册界面
        $('#Land').find('button').eq(1).click(function(){
          $('#Land').hide();
            $('#Register').show();
        })
        //进入登陆界面
        $('#Landout').click(function(){$('.LandInfo').find('.OnLand').click()});
        $('#Landon').click(function(){$('.LandInfo').find('.OnLand').click()});
        $('.LandInfo').find('.OnLand').click(function(){
         var IsLand = $('.LandInfo').find('img').attr('src');
         // 如果未登陆
         if( IsLand == '') {
                 $('#Leave').hide();
               $('#Register').hide();
                 $('#Land').show();
            } else {
               var  IsLandout = confirm('是否注销用户？');
               if( IsLandout ){
                $.ajax({
                url:'/api/visiter/landout',
                success:function(result){
                  if(result.code == 0)
                        window.location.reload();
                      }
                  })
               }
             }
        });
    </script>
    <script src="public/js/message.js"></script>
    <style type="text/css">
        .TheNav a:nth-child(3) .MenuAdd::before{opacity:1;left:-7px;} 
        .TheNav a:nth-child(3) .MenuAdd::after{opacity:1;right:-7px;} 
    </style>
{% endblock %}